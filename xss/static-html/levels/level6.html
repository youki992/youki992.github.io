<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­‰çº§6 - JavaScriptåè®®XSS</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div class="container">
        <header class="fade-in">
            <h1>ç­‰çº§6 - JavaScriptåè®®XSS</h1>
            <p class="subtitle">åˆ©ç”¨JavaScriptåè®®å®ç°XSSæ”»å‡»</p>
        </header>

        <div class="navigation fade-in">
            <a href="../index.html" class="btn btn-secondary">â† è¿”å›ä¸»é¡µ</a>
            <span class="level-info">éš¾åº¦: å›°éš¾ | 6/8</span>
        </div>

        <div class="challenge-area fade-in">
            <h2>æŒ‘æˆ˜æè¿°</h2>
            <p>JavaScriptåè®®XSSæ˜¯ä¸€ç§ç‰¹æ®Šçš„XSSæ”»å‡»æ–¹å¼ï¼Œé€šè¿‡åœ¨URLä¸­ä½¿ç”¨javascript:åè®®æ¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚è¿™ç§æ”»å‡»å¸¸è§äºé“¾æ¥ã€è¡¨å•actionã€iframe srcç­‰åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯å½“åº”ç”¨å…è®¸ç”¨æˆ·è‡ªå®šä¹‰é“¾æ¥æ—¶ã€‚</p>
            
            <div class="alert alert-info">
                <strong>ç›®æ ‡ï¼š</strong>é€šè¿‡ä¿®æ”¹é“¾æ¥URLï¼Œä½¿ç”¨JavaScriptåè®®æ‰§è¡Œæ¶æ„ä»£ç å¹¶å¼¹å‡ºåŒ…å«"XSS"çš„è­¦å‘Šæ¡†ã€‚
            </div>

            <div class="button-group">
                <button class="btn-secondary" onclick="toggleHints()">æ˜¾ç¤ºæç¤º</button>
                <button class="btn-secondary" onclick="showSource()">æŸ¥çœ‹æºç </button>
            </div>
        </div>

        <div class="hint-box fade-in" id="hints" style="display: none;">
            <div class="hint-title">ğŸ’¡ æç¤º</div>
            <ul>
                <li>JavaScriptåè®®å…è®¸åœ¨URLä¸­ç›´æ¥æ‰§è¡ŒJavaScriptä»£ç </li>
                <li>åŸºæœ¬è¯­æ³•ï¼šjavascript:alert('XSS')</li>
                <li>å¯ä»¥æ‰§è¡Œä»»æ„JavaScriptä»£ç </li>
                <li>å°è¯•ä¸åŒçš„ç¼–ç æ–¹å¼ç»•è¿‡è¿‡æ»¤</li>
                <li>ç¤ºä¾‹ï¼šjavascript:alert('XSS')</li>
                <li>ç¼–ç ç¤ºä¾‹ï¼šjavascript:alert(String.fromCharCode(88,83,83))</li>
                <li>ä¹Ÿå¯ä»¥å°è¯•ï¼šjavascript:eval('alert("XSS")')</li>
                <li>æ³¨æ„å¤§å°å†™ï¼šJavaScript:ã€JAVASCRIPT:ç­‰</li>
            </ul>
        </div>

        <div class="challenge-area fade-in">
            <h3>æ¼æ´ä»£ç åˆ†æ</h3>
            <div class="code-block">
// é“¾æ¥ç”Ÿæˆå‡½æ•°
function createLink(url, text) {
    // ç®€å•çš„URLéªŒè¯ï¼ˆå­˜åœ¨ç»•è¿‡æ¼æ´ï¼‰
    if (url.toLowerCase().startsWith('http://') || 
        url.toLowerCase().startsWith('https://') ||
        url.toLowerCase().startsWith('ftp://')) {
        // è®¤ä¸ºæ˜¯å®‰å…¨çš„URL
    } else {
        // å…¶ä»–åè®®å¯èƒ½è¢«å¿½ç•¥ï¼ˆåŒ…æ‹¬javascript:ï¼‰
        console.log('éæ ‡å‡†åè®®URLï¼š' + url);
    }
    
    // ç›´æ¥ç”Ÿæˆé“¾æ¥ï¼ˆå­˜åœ¨XSSæ¼æ´ï¼‰
    const linkHtml = '&lt;a href="' + url + '" target="_blank"&gt;' + text + '&lt;/a&gt;';
    return linkHtml;
}

// è¡¨å•å¤„ç†å‡½æ•°
function updateForm(action) {
    // ç›´æ¥è®¾ç½®è¡¨å•actionï¼ˆå­˜åœ¨XSSæ¼æ´ï¼‰
    document.getElementById('testForm').action = action;
    
    // æ˜¾ç¤ºå½“å‰action
    document.getElementById('formAction').innerHTML = 
        'å½“å‰è¡¨å•action: ' + action;
}

// æ¼æ´åˆ†æï¼š
// 1. URLéªŒè¯ä¸å®Œå–„ï¼Œåªæ£€æŸ¥äº†å¸¸è§çš„http/httpsåè®®
// 2. javascript:åè®®æ²¡æœ‰è¢«è¿‡æ»¤
// 3. ç”¨æˆ·è¾“å…¥ç›´æ¥æ’å…¥åˆ°hrefå±æ€§ä¸­
// 4. è¡¨å•actionä¹Ÿå¯ä»¥ä½¿ç”¨javascript:åè®®

// æ”»å‡»åŸç†ï¼š
// javascript:åè®®å…è®¸åœ¨URLä¸­æ‰§è¡ŒJavaScriptä»£ç 
// å½“ç”¨æˆ·ç‚¹å‡»é“¾æ¥æˆ–æäº¤è¡¨å•æ—¶ï¼Œæ¶æ„ä»£ç è¢«æ‰§è¡Œ
            </div>
        </div>

        <div class="challenge-area fade-in">
            <h3>é“¾æ¥ç”Ÿæˆæµ‹è¯•åŒºåŸŸ</h3>
            
            <div class="form-group">
                <label for="linkUrl">é“¾æ¥URLï¼š</label>
                <input type="text" id="linkUrl" placeholder="è¾“å…¥é“¾æ¥URL..." class="payload-input" value="https://www.example.com">
            </div>
            
            <div class="form-group">
                <label for="linkText">é“¾æ¥æ–‡æœ¬ï¼š</label>
                <input type="text" id="linkText" placeholder="è¾“å…¥é“¾æ¥æ–‡æœ¬..." value="ç‚¹å‡»è¿™é‡Œ">
                <button onclick="generateLink()" class="btn">ç”Ÿæˆé“¾æ¥</button>
            </div>
            
            <div class="output-area">
                <h4>ç”Ÿæˆçš„é“¾æ¥ï¼š</h4>
                <div class="output-box" id="linkContainer">
                    <a href="https://www.example.com" target="_blank">ç‚¹å‡»è¿™é‡Œ</a>
                </div>
            </div>
            
            <div class="form-group">
                <label>ç”Ÿæˆçš„HTMLä»£ç ï¼š</label>
                <textarea id="linkHtml" rows="2" readonly class="code-display"></textarea>
            </div>
        </div>

        <div class="challenge-area fade-in">
            <h3>è¡¨å•Actionæµ‹è¯•åŒºåŸŸ</h3>
            
            <div class="form-group">
                <label for="formActionUrl">è¡¨å•Action URLï¼š</label>
                <input type="text" id="formActionUrl" placeholder="è¾“å…¥è¡¨å•action..." class="payload-input" value="/submit">
                <button onclick="updateFormAction()" class="btn">æ›´æ–°Action</button>
            </div>
            
            <div class="output-area">
                <h4>æµ‹è¯•è¡¨å•ï¼š</h4>
                <div class="output-box">
                    <form id="testForm" action="/submit" method="post" style="padding: 15px; border: 1px solid #ddd; border-radius: 8px; background: white;">
                        <div style="margin-bottom: 10px;">
                            <label>ç”¨æˆ·åï¼š</label>
                            <input type="text" name="username" value="testuser" style="margin-left: 10px; padding: 5px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label>å¯†ç ï¼š</label>
                            <input type="password" name="password" value="password" style="margin-left: 10px; padding: 5px;">
                        </div>
                        <button type="submit" class="btn btn-success">æäº¤è¡¨å•</button>
                    </form>
                </div>
            </div>
            
            <div class="form-group">
                <div id="formAction" class="info-display">
                    å½“å‰è¡¨å•action: /submit
                </div>
            </div>
            
            <div class="alert alert-warning">
                <strong>JavaScriptåè®®ç‰¹ç‚¹ï¼š</strong>
                <ul>
                    <li>å¯åœ¨ä»»ä½•æ¥å—URLçš„åœ°æ–¹ä½¿ç”¨</li>
                    <li>æ‰§è¡Œæ—¶æœºï¼šç‚¹å‡»é“¾æ¥ã€æäº¤è¡¨å•ã€åŠ è½½èµ„æºæ—¶</li>
                    <li>ç»•è¿‡æŠ€å·§ï¼šå¤§å°å†™æ··åˆã€ç¼–ç ã€ç©ºæ ¼ç­‰</li>
                    <li>å±é™©åœºæ™¯ï¼šhrefã€srcã€actionç­‰å±æ€§</li>
                    <li>é˜²æŠ¤ï¼šä¸¥æ ¼çš„URLåè®®ç™½åå•éªŒè¯</li>
                </ul>
            </div>
        </div>

        <footer class="footer">
            <p>Â© 2024 XSSæŒ‘æˆ˜é¶åœº | ä»…ä¾›å­¦ä¹ ä½¿ç”¨</p>
        </footer>
    </div>

    <script>
        // é‡å†™alertå‡½æ•°ä»¥æ£€æµ‹XSSæˆåŠŸ
        const originalAlert = window.alert;
        window.alert = function(message) {
            originalAlert(message);
            if (message && message.toString().toLowerCase().includes('xss')) {
                setTimeout(() => {
                    alert('ğŸ‰ æ­å–œï¼JavaScriptåè®®XSSæ”»å‡»æˆåŠŸï¼ä½ å·²ç»æŒæ¡äº†JavaScriptåè®®åˆ©ç”¨æŠ€æœ¯ï¼');
                }, 100);
            }
        };

        // JavaScriptåè®®XSSæ¼æ´å‡½æ•°
        function createLink(url, text) {
            // ä¸å®Œå–„çš„URLéªŒè¯ï¼ˆå­˜åœ¨ç»•è¿‡æ¼æ´ï¼‰
            if (url.toLowerCase().startsWith('http://') || 
                url.toLowerCase().startsWith('https://') ||
                url.toLowerCase().startsWith('ftp://')) {
                console.log('æ ‡å‡†åè®®URLï¼š' + url);
            } else {
                console.log('éæ ‡å‡†åè®®URLï¼š' + url);
            }
            
            // å­˜åœ¨XSSæ¼æ´ï¼šç›´æ¥æ’å…¥URL
            const linkHtml = '<a href="' + url + '" target="_blank" style="color: #007bff; text-decoration: underline;">' + text + '</a>';
            return linkHtml;
        }

        function updateForm(action) {
            // å­˜åœ¨XSSæ¼æ´ï¼šç›´æ¥è®¾ç½®action
            document.getElementById('testForm').action = action;
            
            document.getElementById('formAction').innerHTML = 
                'å½“å‰è¡¨å•action: <code>' + action + '</code>';
        }

        function generateLink() {
            const url = document.getElementById('linkUrl').value;
            const text = document.getElementById('linkText').value;
            
            if (!url.trim() || !text.trim()) {
                alert('è¯·å¡«å†™é“¾æ¥URLå’Œæ–‡æœ¬');
                return;
            }
            
            const linkHtml = createLink(url, text);
            document.getElementById('linkContainer').innerHTML = linkHtml;
            document.getElementById('linkHtml').value = linkHtml;
        }

        function updateFormAction() {
            const action = document.getElementById('formActionUrl').value;
            
            if (!action.trim()) {
                alert('è¯·è¾“å…¥è¡¨å•action');
                return;
            }
            
            updateForm(action);
        }

        // é¡µé¢åŠŸèƒ½å‡½æ•°
        function toggleHints() {
            const hints = document.getElementById('hints');
            hints.style.display = hints.style.display === 'none' ? 'block' : 'none';
        }

        function showSource() {
            alert('æºç å·²åœ¨"æ¼æ´ä»£ç åˆ†æ"éƒ¨åˆ†æ˜¾ç¤ºï¼Œè¯·æŸ¥çœ‹ä¸Šæ–¹çš„ä»£ç å—ã€‚');
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
        window.onload = function() {
            // åˆå§‹åŒ–æ˜¾ç¤º
            generateLink();
            
            // é¡µé¢åŠ è½½åŠ¨ç”»
            const elements = document.querySelectorAll('.fade-in');
            elements.forEach((element, index) => {
                setTimeout(() => {
                    element.style.opacity = '0';
                    element.style.transform = 'translateY(20px)';
                    element.style.transition = 'all 0.6s ease';
                    setTimeout(() => {
                        element.style.opacity = '1';
                        element.style.transform = 'translateY(0)';
                    }, 100);
                }, index * 200);
            });
        };

        // å›è½¦æäº¤
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                if (event.target.id === 'linkUrl' || event.target.id === 'linkText') {
                    generateLink();
                } else if (event.target.id === 'formActionUrl') {
                    updateFormAction();
                }
            }
        });

        // é˜»æ­¢è¡¨å•å®é™…æäº¤ï¼ˆé¿å…é¡µé¢è·³è½¬ï¼‰
        document.getElementById('testForm').addEventListener('submit', function(event) {
            event.preventDefault();
            alert('è¡¨å•æäº¤è¢«é˜»æ­¢ï¼ˆæ¼”ç¤ºç›®çš„ï¼‰');
        });
    </script>

    <style>
        .payload-input {
            font-family: 'Courier New', monospace;
            background-color: #f8f9fa;
        }

        .code-display {
            font-family: 'Courier New', monospace;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            resize: vertical;
        }

        .info-display {
            background: #e9ecef;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .info-display code {
            background: #f8f9fa;
            padding: 2px 4px;
            border-radius: 3px;
            color: #e83e8c;
        }

        .output-area {
            margin: 20px 0;
        }

        .output-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            min-height: 60px;
            word-wrap: break-word;
        }

        .output-box a {
            font-size: 16px;
            font-weight: 500;
        }

        .output-box form {
            margin: 0;
        }

        .output-box form label {
            font-weight: bold;
            color: #333;
        }

        .output-box form input {
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 5px 8px;
        }
    </style>
</body>
</html>