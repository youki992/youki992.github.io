<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­‰çº§8 - å¢å¼ºç‰ˆç¼“å­˜ä¸­æ¯’XSS</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div class="container">
        <header class="fade-in">
            <h1>ç­‰çº§8 - å¢å¼ºç‰ˆç¼“å­˜ä¸­æ¯’XSS</h1>
            <p class="subtitle">ç»•è¿‡å¤šé‡è¿‡æ»¤æœºåˆ¶ï¼Œåˆ©ç”¨ç¼“å­˜æœºåˆ¶è¿›è¡Œé«˜çº§XSSæ”»å‡»</p>
        </header>

        <div class="navigation fade-in">
            <a href="../index.html" class="btn btn-secondary">â† è¿”å›ä¸»é¡µ</a>
            <span class="level-info">éš¾åº¦: æéš¾ | 8/8</span>
        </div>

        <div class="challenge-area fade-in">
            <h2>æŒ‘æˆ˜æè¿°</h2>
            <p>å¢å¼ºç‰ˆç¼“å­˜ä¸­æ¯’XSSæ˜¯æœ€é«˜éš¾åº¦çš„æŒ‘æˆ˜ã€‚æœåŠ¡å™¨æ·»åŠ äº†å¤šé‡è¿‡æ»¤æœºåˆ¶ï¼Œä½ éœ€è¦æ‰¾åˆ°ç»•è¿‡æ‰€æœ‰è¿‡æ»¤å™¨çš„æ–¹æ³•æ¥å®ç°XSSæ”»å‡»ã€‚è¿™ä¸ªæŒ‘æˆ˜ç»“åˆäº†é«˜çº§è¿‡æ»¤ç»•è¿‡æŠ€æœ¯å’Œç¼“å­˜æœºåˆ¶åˆ©ç”¨ã€‚</p>
            
            <div class="alert alert-info">
                <strong>ç›®æ ‡ï¼š</strong>ç»•è¿‡æœåŠ¡å™¨çš„å¤šé‡è¿‡æ»¤æœºåˆ¶ï¼Œé€šè¿‡ç¼“å­˜ä¸­æ¯’æŠ€æœ¯æˆåŠŸæ‰§è¡ŒJavaScriptä»£ç ã€‚
            </div>

            <div class="button-group">
                <button class="btn-secondary" onclick="toggleHints()">æ˜¾ç¤ºæç¤º</button>
                <button class="btn-secondary" onclick="showSource()">æŸ¥çœ‹æºç </button>
            </div>
        </div>

        <div class="hint-box fade-in" id="hints" style="display: none;">
            <div class="hint-title">ğŸ’¡ æç¤º</div>
            <ul>
                <li>ç³»ç»Ÿè¿‡æ»¤äº†å¤§éƒ¨åˆ†å¸¸è§XSSæ ‡ç­¾å’Œäº‹ä»¶</li>
                <li>å°è¯•ä½¿ç”¨ä¸å¸¸è§çš„HTMLæ ‡ç­¾ï¼Œå¦‚&lt;details&gt;ã€&lt;summary&gt;</li>
                <li>å¯ä»¥å°è¯•ä½¿ç”¨æ›¿ä»£å‡½æ•°ï¼Œå¦‚setTimeoutã€setInterval</li>
                <li>HTMLå®ä½“ç¼–ç å¯èƒ½æœ‰æ•ˆï¼š&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;</li>
                <li>å°è¯•SVGæ ‡ç­¾ï¼š&lt;svg&gt;&lt;animateTransform onbegin="alert('XSS')"&gt;</li>
                <li>åˆ©ç”¨onerroräº‹ä»¶ï¼š&lt;img src=x onerror="alert('XSS')"&gt;</li>
                <li>ç¼“å­˜æœºåˆ¶å¯èƒ½ä¼šä¿å­˜æ¶æ„å†…å®¹</li>
            </ul>
        </div>

        <div class="challenge-area fade-in">
            <h3>è¿‡æ»¤æœºåˆ¶åˆ†æ</h3>
            <div class="code-block">
// å¢å¼ºç‰ˆè¿‡æ»¤å‡½æ•°
function advancedFilter(input) {
    let filtered = input;
    
    // è¿‡æ»¤å¸¸è§XSSæ ‡ç­¾
    const dangerousTags = [
        'script', 'iframe', 'object', 'embed', 'applet',
        'form', 'input', 'textarea', 'select', 'button'
    ];
    
    dangerousTags.forEach(tag => {
        const regex = new RegExp(`&lt;\\/?${tag}[^&gt;]*&gt;`, 'gi');
        filtered = filtered.replace(regex, '');
    });
    
    // è¿‡æ»¤å¸¸è§äº‹ä»¶å¤„ç†å™¨
    const events = [
        'onclick', 'onload', 'onmouseover', 'onmouseout',
        'onfocus', 'onblur', 'onchange', 'onsubmit'
    ];
    
    events.forEach(event => {
        const regex = new RegExp(event + '\\s*=', 'gi');
        filtered = filtered.replace(regex, '');
    });
    
    // è¿‡æ»¤JavaScriptåè®®
    filtered = filtered.replace(/javascript:/gi, '');
    
    // è¿‡æ»¤ä¸€äº›å±é™©å‡½æ•°
    filtered = filtered.replace(/alert|eval|setTimeout|setInterval/gi, '');
    
    return filtered;
}

// ç¼“å­˜æœºåˆ¶
const cache = new Map();

function getCachedContent(key) {
    return cache.get(key);
}

function setCachedContent(key, content) {
    // ç¼“å­˜ç”¨æˆ·è¾“å…¥ï¼ˆå¯èƒ½åŒ…å«æ¶æ„å†…å®¹ï¼‰
    cache.set(key, content);
}

// æ¼æ´åˆ†æï¼š
// 1. è¿‡æ»¤ä¸å¤Ÿå…¨é¢ï¼Œä»æœ‰ç»•è¿‡å¯èƒ½
// 2. ç¼“å­˜æœºåˆ¶å¯èƒ½ä¿å­˜æ¶æ„å†…å®¹
// 3. æŸäº›HTML5æ ‡ç­¾å’Œäº‹ä»¶æœªè¢«è¿‡æ»¤
// 4. ç¼–ç ç»•è¿‡å¯èƒ½æœ‰æ•ˆ
            </div>
        </div>

        <div class="challenge-area fade-in">
            <h3>ç»•è¿‡æ€è·¯</h3>
            <div class="alert alert-info">
                <ul>
                    <li><strong>æ ‡ç­¾ç»•è¿‡ï¼š</strong>ä½¿ç”¨ä¸å¸¸è§çš„HTMLæ ‡ç­¾å¦‚detailsã€summaryã€dialog</li>
                    <li><strong>äº‹ä»¶ç»•è¿‡ï¼š</strong>ä½¿ç”¨ontoggleã€onbeginã€onendç­‰ä¸å¸¸è§äº‹ä»¶</li>
                    <li><strong>ç¼–ç ç»•è¿‡ï¼š</strong>HTMLå®ä½“ç¼–ç ã€Unicodeç¼–ç </li>
                    <li><strong>å‡½æ•°ç»•è¿‡ï¼š</strong>ä½¿ç”¨æ„é€ å‡½æ•°ã€å­—ç¬¦ä¸²æ‹¼æ¥ç­‰æ–¹å¼</li>
                    <li><strong>ç¼“å­˜åˆ©ç”¨ï¼š</strong>åˆ©ç”¨ç¼“å­˜æœºåˆ¶ä¿å­˜å’Œæ‰§è¡Œæ¶æ„ä»£ç </li>
                </ul>
            </div>
        </div>

        <div class="challenge-area fade-in">
            <h3>æµ‹è¯•åŒºåŸŸ</h3>
            
            <div class="form-group">
                <label for="payloadInput">ç»•è¿‡è¿‡æ»¤å™¨ï¼š</label>
                <textarea id="payloadInput" rows="4" placeholder="è¾“å…¥ä½ çš„payloadæ¥ç»•è¿‡è¿‡æ»¤å™¨..." class="payload-input"></textarea>
                <button onclick="testPayload()" class="btn">æµ‹è¯•Payload</button>
                <button onclick="clearCache()" class="btn btn-danger">æ¸…ç©ºç¼“å­˜</button>
            </div>
            
            <div class="output-area">
                <h4>è¿‡æ»¤ç»“æœï¼š</h4>
                <div class="output-box" id="filterResult">
                    è¿‡æ»¤ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ
                </div>
            </div>
            
            <div class="output-area">
                <h4>æ‰§è¡Œç»“æœï¼š</h4>
                <div class="output-box" id="executeResult">
                    æ‰§è¡Œç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ
                </div>
            </div>
            
            <div class="form-group">
                <label>ç¼“å­˜å†…å®¹ï¼š</label>
                <textarea id="cacheContent" rows="3" readonly class="code-display"></textarea>
            </div>
            
            <div class="alert alert-warning">
                <strong>ç»•è¿‡æŠ€å·§ï¼š</strong>
                <ul>
                    <li>SVGåŠ¨ç”»ï¼š&lt;svg&gt;&lt;animateTransform onbegin="alert('XSS')"&gt;</li>
                    <li>Detailsæ ‡ç­¾ï¼š&lt;details open ontoggle="alert('XSS')"&gt;</li>
                    <li>IMGæ ‡ç­¾ï¼š&lt;img src=x onerror="alert('XSS')"&gt;</li>
                    <li>å¤§å°å†™æ··åˆï¼š&lt;ScRiPt&gt;ã€OnClIcK</li>
                    <li>HTMLå®ä½“ç¼–ç ï¼š&amp;#97;lert('XSS')</li>
                    <li>æ›¿ä»£å‡½æ•°ï¼šFunction('alert("XSS")')()ã€[].constructor.constructor('alert("XSS")')())</li>
                </ul>
            </div>
        </div>

        <footer class="footer">
            <p>Â© 2024 XSSæŒ‘æˆ˜é¶åœº | ä»…ä¾›å­¦ä¹ ä½¿ç”¨</p>
        </footer>
    </div>

    <script>
        // ç¼“å­˜ç³»ç»Ÿ
        const cache = new Map();
        
        // é‡å†™alertå‡½æ•°ä»¥æ£€æµ‹XSSæˆåŠŸ
        const originalAlert = window.alert;
        window.alert = function(message) {
            originalAlert(message);
            if (message && message.toString().toLowerCase().includes('xss')) {
                setTimeout(() => {
                    alert('ğŸ‰ æ­å–œï¼ä½ å·²å®Œæˆæ‰€æœ‰XSSæŒ‘æˆ˜ï¼ä½ å·²ç»æˆä¸ºXSSå¤§å¸ˆï¼');
                }, 100);
            }
        };

        // å¢å¼ºç‰ˆè¿‡æ»¤å‡½æ•°
        function advancedFilter(input) {
            let filtered = input;
            
            // è¿‡æ»¤å¸¸è§XSSæ ‡ç­¾
            const dangerousTags = [
                'script', 'iframe', 'object', 'embed', 'applet',
                'form', 'input', 'textarea', 'select', 'button'
            ];
            
            dangerousTags.forEach(tag => {
                const regex = new RegExp(`<\\/?${tag}[^>]*>`, 'gi');
                filtered = filtered.replace(regex, '');
            });
            
            // è¿‡æ»¤å¸¸è§äº‹ä»¶å¤„ç†å™¨
            const events = [
                'onclick', 'onload', 'onmouseover', 'onmouseout',
                'onfocus', 'onblur', 'onchange', 'onsubmit'
            ];
            
            events.forEach(event => {
                const regex = new RegExp(event + '\\s*=', 'gi');
                filtered = filtered.replace(regex, '');
            });
            
            // è¿‡æ»¤JavaScriptåè®®
            filtered = filtered.replace(/javascript:/gi, '');
            
            // è¿‡æ»¤ä¸€äº›å±é™©å‡½æ•°ï¼ˆä¸å®Œå…¨ï¼‰
            filtered = filtered.replace(/alert|eval|setTimeout|setInterval/gi, '');
            
            return filtered;
        }

        function getCachedContent(key) {
            return cache.get(key);
        }

        function setCachedContent(key, content) {
            cache.set(key, content);
            updateCacheDisplay();
        }

        function updateCacheDisplay() {
            const cacheEntries = Array.from(cache.entries());
            const cacheText = cacheEntries.map(([key, value]) => `${key}: ${value}`).join('\n');
            document.getElementById('cacheContent').value = cacheText || 'ç¼“å­˜ä¸ºç©º';
        }

        function testPayload() {
            const payload = document.getElementById('payloadInput').value;
            
            if (!payload.trim()) {
                alert('è¯·è¾“å…¥payload');
                return;
            }
            
            // åº”ç”¨è¿‡æ»¤
            const filtered = advancedFilter(payload);
            document.getElementById('filterResult').innerHTML = 
                '<strong>åŸå§‹è¾“å…¥ï¼š</strong><br>' + escapeHtml(payload) + 
                '<br><br><strong>è¿‡æ»¤åï¼š</strong><br>' + escapeHtml(filtered);
            
            // ç¼“å­˜å†…å®¹
            const cacheKey = 'payload_' + Date.now();
            setCachedContent(cacheKey, filtered);
            
            // æ‰§è¡Œè¿‡æ»¤åçš„å†…å®¹ï¼ˆå­˜åœ¨XSSæ¼æ´ï¼‰
            try {
                document.getElementById('executeResult').innerHTML = filtered;
            } catch (error) {
                document.getElementById('executeResult').innerHTML = 
                    '<span style="color: red;">æ‰§è¡Œé”™è¯¯: ' + error.message + '</span>';
            }
        }

        function clearCache() {
            cache.clear();
            updateCacheDisplay();
            document.getElementById('executeResult').innerHTML = 'ç¼“å­˜å·²æ¸…ç©º';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // é¡µé¢åŠŸèƒ½å‡½æ•°
        function toggleHints() {
            const hints = document.getElementById('hints');
            hints.style.display = hints.style.display === 'none' ? 'block' : 'none';
        }

        function showSource() {
            alert('æºç å·²åœ¨"è¿‡æ»¤æœºåˆ¶åˆ†æ"éƒ¨åˆ†æ˜¾ç¤ºï¼Œè¯·æŸ¥çœ‹ä¸Šæ–¹çš„ä»£ç å—ã€‚');
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
        window.onload = function() {
            updateCacheDisplay();
            
            // é¡µé¢åŠ è½½åŠ¨ç”»
            const elements = document.querySelectorAll('.fade-in');
            elements.forEach((element, index) => {
                setTimeout(() => {
                    element.style.opacity = '0';
                    element.style.transform = 'translateY(20px)';
                    element.style.transition = 'all 0.6s ease';
                    setTimeout(() => {
                        element.style.opacity = '1';
                        element.style.transform = 'translateY(0)';
                    }, 100);
                }, index * 200);
            });
        };

        // å›è½¦æµ‹è¯•
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && event.ctrlKey && event.target.id === 'payloadInput') {
                testPayload();
            }
        });

        // æä¾›ä¸€äº›å¯èƒ½è¢«åˆ©ç”¨çš„å…¨å±€å‡½æ•°
        window.processData = function(data) {
            return new Function('return ' + data)();
        };

        window.renderContent = function(content) {
            document.getElementById('executeResult').innerHTML = content;
        };
    </script>

    <style>
        .payload-input {
            font-family: 'Courier New', monospace;
            background-color: #f8f9fa;
        }

        .code-display {
            font-family: 'Courier New', monospace;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            resize: vertical;
        }

        .output-area {
            margin: 20px 0;
        }

        .output-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            min-height: 80px;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        #executeResult {
            background: #fff3cd;
            border-color: #ffeaa7;
        }

        #cacheContent {
            background-color: #e9ecef;
            border-color: #ced4da;
            color: #495057;
        }

        textarea {
            resize: vertical;
        }

        .alert-info ul {
            margin: 0;
            padding-left: 20px;
        }

        .alert-info li {
            margin: 5px 0;
        }
    </style>
</body>
</html>