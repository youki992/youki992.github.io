<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­‰çº§3 - å­˜å‚¨å‹XSS</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div class="container">
        <header class="fade-in">
            <h1>ç­‰çº§3 - å­˜å‚¨å‹XSS</h1>
            <p class="subtitle">é€šè¿‡ç•™è¨€æ¿å®ç°æŒä¹…åŒ–XSSæ”»å‡»</p>
        </header>

        <div class="navigation fade-in">
            <a href="../index.html" class="btn btn-secondary">â† è¿”å›ä¸»é¡µ</a>
            <span class="level-info">éš¾åº¦: ä¸­ç­‰ | 3/8</span>
        </div>

        <div class="challenge-area fade-in">
            <h2>æŒ‘æˆ˜æè¿°</h2>
            <p>å­˜å‚¨å‹XSSæ˜¯æœ€å±é™©çš„XSSç±»å‹ï¼Œæ¶æ„ä»£ç è¢«æ°¸ä¹…å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šï¼Œæ¯å½“ç”¨æˆ·è®¿é—®åŒ…å«æ¶æ„ä»£ç çš„é¡µé¢æ—¶éƒ½ä¼šæ‰§è¡Œæ”»å‡»ã€‚è¿™ç§æ”»å‡»å½±å“æ‰€æœ‰è®¿é—®è¯¥é¡µé¢çš„ç”¨æˆ·ã€‚</p>
            
            <div class="alert alert-info">
                <strong>ç›®æ ‡ï¼š</strong>åœ¨ç•™è¨€æ¿ä¸­æäº¤æ¶æ„ä»£ç ï¼Œä½¿å…¶è¢«å­˜å‚¨å¹¶åœ¨é¡µé¢æ˜¾ç¤ºæ—¶æ‰§è¡Œï¼Œå¼¹å‡ºåŒ…å«"XSS"çš„è­¦å‘Šæ¡†ã€‚
            </div>

            <div class="button-group">
                <button class="btn-secondary" onclick="toggleHints()">æ˜¾ç¤ºæç¤º</button>
                <button class="btn-secondary" onclick="showSource()">æŸ¥çœ‹æºç </button>
            </div>
        </div>

        <div class="hint-box fade-in" id="hints" style="display: none;">
            <div class="hint-title">ğŸ’¡ æç¤º</div>
            <ul>
                <li>ç•™è¨€å†…å®¹ç›´æ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼Œæ²¡æœ‰è¿‡æ»¤</li>
                <li>å¯ä»¥åœ¨ç•™è¨€ä¸­æ’å…¥HTMLæ ‡ç­¾å’ŒJavaScriptä»£ç </li>
                <li>å°è¯•æäº¤åŒ…å«&lt;script&gt;æ ‡ç­¾çš„ç•™è¨€</li>
                <li>ä¹Ÿå¯ä»¥å°è¯•äº‹ä»¶å¤„ç†å™¨ï¼Œå¦‚onclickã€onloadç­‰</li>
                <li>ç¤ºä¾‹payloadï¼š&lt;script&gt;alert('XSS')&lt;/script&gt;</li>
                <li>æˆ–è€…ï¼š&lt;img src=x onerror="alert('XSS')"&gt;</li>
            </ul>
        </div>

        <div class="challenge-area fade-in">
            <h3>æ¼æ´ä»£ç åˆ†æ</h3>
            <div class="code-block">
// æ¨¡æ‹ŸæœåŠ¡å™¨ç«¯å­˜å‚¨é€»è¾‘
function addComment(name, message) {
    // ç›´æ¥å­˜å‚¨ç”¨æˆ·è¾“å…¥ï¼Œæ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼ˆå­˜åœ¨XSSæ¼æ´ï¼‰
    const comment = {
        id: Date.now(),
        name: name,
        message: message,  // å±é™©ï¼šç›´æ¥å­˜å‚¨åŸå§‹è¾“å…¥
        timestamp: new Date().toLocaleString()
    };
    
    // å­˜å‚¨åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆæ¨¡æ‹Ÿæ•°æ®åº“ï¼‰
    let comments = JSON.parse(localStorage.getItem('comments') || '[]');
    comments.push(comment);
    localStorage.setItem('comments', JSON.stringify(comments));
    
    return comment;
}

// æ˜¾ç¤ºç•™è¨€çš„å‡½æ•°
function displayComments() {
    const comments = JSON.parse(localStorage.getItem('comments') || '[]');
    const container = document.getElementById('comments');
    
    container.innerHTML = '';
    comments.forEach(comment => {
        // å±é™©ï¼šç›´æ¥ä½¿ç”¨innerHTMLè¾“å‡ºç”¨æˆ·æ•°æ®
        container.innerHTML += `
            &lt;div class="comment"&gt;
                &lt;strong&gt;${comment.name}&lt;/strong&gt;
                &lt;span class="timestamp"&gt;${comment.timestamp}&lt;/span&gt;
                &lt;p&gt;${comment.message}&lt;/p&gt;  // XSSæ¼æ´ç‚¹
            &lt;/div&gt;
        `;
    });
}

// æ¼æ´åˆ†æï¼š
// 1. ç”¨æˆ·è¾“å…¥ç›´æ¥å­˜å‚¨ï¼Œæ²¡æœ‰éªŒè¯æˆ–è¿‡æ»¤
// 2. æ˜¾ç¤ºæ—¶ä½¿ç”¨innerHTMLï¼Œå…è®¸HTML/JSæ‰§è¡Œ
// 3. å½±å“æ‰€æœ‰è®¿é—®é¡µé¢çš„ç”¨æˆ·ï¼ˆæŒä¹…åŒ–æ”»å‡»ï¼‰
            </div>
        </div>

        <div class="challenge-area fade-in">
            <h3>ç•™è¨€æ¿æµ‹è¯•åŒºåŸŸ</h3>
            
            <div class="form-group">
                <label for="nameInput">å§“åï¼š</label>
                <input type="text" id="nameInput" placeholder="è¾“å…¥æ‚¨çš„å§“å" value="æµ‹è¯•ç”¨æˆ·">
            </div>
            
            <div class="form-group">
                <label for="messageInput">ç•™è¨€å†…å®¹ï¼š</label>
                <textarea id="messageInput" rows="4" placeholder="åœ¨è¿™é‡Œè¾“å…¥æ‚¨çš„ç•™è¨€...å¯ä»¥å°è¯•æ’å…¥HTMLæ ‡ç­¾"></textarea>
            </div>
            
            <div class="button-group">
                <button onclick="submitComment()" class="btn">æäº¤ç•™è¨€</button>
                <button onclick="clearComments()" class="btn btn-danger">æ¸…ç©ºç•™è¨€</button>
            </div>
            
            <div class="alert alert-warning">
                <strong>å­˜å‚¨å‹XSSç‰¹ç‚¹ï¼š</strong>
                <ul>
                    <li>æ¶æ„ä»£ç è¢«æ°¸ä¹…å­˜å‚¨åœ¨æœåŠ¡å™¨</li>
                    <li>å½±å“æ‰€æœ‰è®¿é—®è¯¥é¡µé¢çš„ç”¨æˆ·</li>
                    <li>æ”»å‡»æŒç»­æ—¶é—´é•¿ï¼Œå±å®³æœ€å¤§</li>
                    <li>å¸¸è§äºç•™è¨€æ¿ã€è¯„è®ºç³»ç»Ÿã€ç”¨æˆ·èµ„æ–™ç­‰</li>
                </ul>
            </div>
        </div>

        <div class="challenge-area fade-in">
            <h3>ç•™è¨€åˆ—è¡¨</h3>
            <div id="comments" class="comments-container">
                <!-- ç•™è¨€å°†åŠ¨æ€æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
            </div>
        </div>

        <footer class="footer">
            <p>Â© 2024 XSSæŒ‘æˆ˜é¶åœº | ä»…ä¾›å­¦ä¹ ä½¿ç”¨</p>
        </footer>
    </div>

    <script>
        // é‡å†™alertå‡½æ•°ä»¥æ£€æµ‹XSSæˆåŠŸ
        const originalAlert = window.alert;
        window.alert = function(message) {
            originalAlert(message);
            if (message && message.toString().toLowerCase().includes('xss')) {
                setTimeout(() => {
                    alert('ğŸ‰ æ­å–œï¼å­˜å‚¨å‹XSSæ”»å‡»æˆåŠŸï¼ä½ å·²ç»æŒæ¡äº†å­˜å‚¨å‹XSSæŠ€æœ¯ï¼');
                }, 100);
            }
        };

        // å­˜å‚¨å‹XSSæ¼æ´å‡½æ•°
        function addComment(name, message) {
            const comment = {
                id: Date.now(),
                name: name,
                message: message,  // ç›´æ¥å­˜å‚¨ï¼Œå­˜åœ¨XSSæ¼æ´
                timestamp: new Date().toLocaleString()
            };
            
            let comments = JSON.parse(localStorage.getItem('comments') || '[]');
            comments.push(comment);
            localStorage.setItem('comments', JSON.stringify(comments));
            
            return comment;
        }

        function displayComments() {
            const comments = JSON.parse(localStorage.getItem('comments') || '[]');
            const container = document.getElementById('comments');
            
            container.innerHTML = '';
            comments.forEach(comment => {
                // å­˜åœ¨XSSæ¼æ´çš„ä»£ç 
                container.innerHTML += `
                    <div class="comment">
                        <div class="comment-header">
                            <strong>${comment.name}</strong>
                            <span class="timestamp">${comment.timestamp}</span>
                        </div>
                        <div class="comment-body">
                            ${comment.message}
                        </div>
                    </div>
                `;
            });
            
            if (comments.length === 0) {
                container.innerHTML = '<p class="no-comments">æš‚æ— ç•™è¨€ï¼Œå¿«æ¥å‘è¡¨ç¬¬ä¸€æ¡ç•™è¨€å§ï¼</p>';
            }
        }

        function submitComment() {
            const name = document.getElementById('nameInput').value.trim();
            const message = document.getElementById('messageInput').value.trim();
            
            if (!name || !message) {
                alert('è¯·å¡«å†™å§“åå’Œç•™è¨€å†…å®¹');
                return;
            }
            
            addComment(name, message);
            displayComments();
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('messageInput').value = '';
            
            alert('ç•™è¨€æäº¤æˆåŠŸï¼');
        }

        function clearComments() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç•™è¨€å—ï¼Ÿ')) {
                localStorage.removeItem('comments');
                displayComments();
                alert('ç•™è¨€å·²æ¸…ç©º');
            }
        }

        // é¡µé¢åŠŸèƒ½å‡½æ•°
        function toggleHints() {
            const hints = document.getElementById('hints');
            hints.style.display = hints.style.display === 'none' ? 'block' : 'none';
        }

        function showSource() {
            alert('æºç å·²åœ¨"æ¼æ´ä»£ç åˆ†æ"éƒ¨åˆ†æ˜¾ç¤ºï¼Œè¯·æŸ¥çœ‹ä¸Šæ–¹çš„ä»£ç å—ã€‚');
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
        window.onload = function() {
            displayComments();
            
            // é¡µé¢åŠ è½½åŠ¨ç”»
            const elements = document.querySelectorAll('.fade-in');
            elements.forEach((element, index) => {
                setTimeout(() => {
                    element.style.opacity = '0';
                    element.style.transform = 'translateY(20px)';
                    element.style.transition = 'all 0.6s ease';
                    setTimeout(() => {
                        element.style.opacity = '1';
                        element.style.transform = 'translateY(0)';
                    }, 100);
                }, index * 200);
            });
        };

        // å›è½¦æäº¤ç•™è¨€
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && event.ctrlKey) {
                submitComment();
            }
        });
    </script>

    <style>
        .comments-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: #f9f9f9;
        }

        .comment {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }

        .comment-header strong {
            color: #333;
            font-size: 14px;
        }

        .timestamp {
            color: #666;
            font-size: 12px;
        }

        .comment-body {
            color: #444;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .no-comments {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }
    </style>
</body>
</html>