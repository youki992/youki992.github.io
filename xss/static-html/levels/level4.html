<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­‰çº§4 - è¿‡æ»¤ç»•è¿‡XSS</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div class="container">
        <header class="fade-in">
            <h1>ç­‰çº§4 - è¿‡æ»¤ç»•è¿‡XSS</h1>
            <p class="subtitle">ç»•è¿‡åŸºç¡€è¿‡æ»¤æœºåˆ¶å®ç°XSSæ”»å‡»</p>
        </header>

        <div class="navigation fade-in">
            <a href="../index.html" class="btn btn-secondary">â† è¿”å›ä¸»é¡µ</a>
            <span class="level-info">éš¾åº¦: ä¸­ç­‰ | 4/8</span>
        </div>

        <div class="challenge-area fade-in">
            <h2>æŒ‘æˆ˜æè¿°</h2>
            <p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¼€å‘è€…é€šå¸¸ä¼šå®æ–½ä¸€äº›åŸºç¡€çš„è¿‡æ»¤æœºåˆ¶æ¥é˜²æ­¢XSSæ”»å‡»ã€‚ä½†æ˜¯ï¼Œä¸å®Œå–„çš„è¿‡æ»¤å¾€å¾€å¯ä»¥è¢«ç»•è¿‡ã€‚è¿™ä¸ªæŒ‘æˆ˜æ¨¡æ‹Ÿäº†ä¸€ä¸ªæœ‰åŸºç¡€è¿‡æ»¤çš„æœç´¢åŠŸèƒ½ã€‚</p>
            
            <div class="alert alert-info">
                <strong>ç›®æ ‡ï¼š</strong>ç»•è¿‡è¾“å…¥è¿‡æ»¤æœºåˆ¶ï¼ŒæˆåŠŸæ‰§è¡ŒJavaScriptä»£ç å¹¶å¼¹å‡ºåŒ…å«"XSS"çš„è­¦å‘Šæ¡†ã€‚
            </div>

            <div class="button-group">
                <button class="btn-secondary" onclick="toggleHints()">æ˜¾ç¤ºæç¤º</button>
                <button class="btn-secondary" onclick="showSource()">æŸ¥çœ‹æºç </button>
            </div>
        </div>

        <div class="hint-box fade-in" id="hints" style="display: none;">
            <div class="hint-title">ğŸ’¡ æç¤º</div>
            <ul>
                <li>ç³»ç»Ÿè¿‡æ»¤äº†&lt;script&gt;æ ‡ç­¾ï¼Œä½†å¯èƒ½æœ‰å…¶ä»–æ–¹å¼</li>
                <li>å°è¯•ä½¿ç”¨äº‹ä»¶å¤„ç†å™¨ï¼Œå¦‚onclickã€onloadã€onerrorç­‰</li>
                <li>å¯ä»¥å°è¯•å¤§å°å†™æ··åˆæ¥ç»•è¿‡è¿‡æ»¤</li>
                <li>HTMLå®ä½“ç¼–ç å¯èƒ½æœ‰æ•ˆ</li>
                <li>ç¤ºä¾‹ï¼š&lt;img src=x onerror="alert('XSS')"&gt;</li>
                <li>æˆ–è€…ï¼š&lt;ScRiPt&gt;alert('XSS')&lt;/ScRiPt&gt;</li>
                <li>è¿˜å¯ä»¥å°è¯•ï¼š&lt;svg onload="alert('XSS')"&gt;</li>
            </ul>
        </div>

        <div class="challenge-area fade-in">
            <h3>è¿‡æ»¤æœºåˆ¶åˆ†æ</h3>
            <div class="code-block">
// åŸºç¡€è¿‡æ»¤å‡½æ•°
function basicFilter(input) {
    // è¿‡æ»¤å¸¸è§çš„XSSæ ‡ç­¾ï¼ˆä¸å®Œå–„çš„è¿‡æ»¤ï¼‰
    let filtered = input;
    
    // è¿‡æ»¤scriptæ ‡ç­¾ï¼ˆä»…å°å†™ï¼‰
    filtered = filtered.replace(/&lt;script&gt;/gi, '');
    filtered = filtered.replace(/&lt;\/script&gt;/gi, '');
    
    // è¿‡æ»¤ä¸€äº›å±é™©çš„äº‹ä»¶ï¼ˆä¸å®Œæ•´ï¼‰
    filtered = filtered.replace(/javascript:/gi, '');
    filtered = filtered.replace(/on\w+=/gi, '');
    
    return filtered;
}

// æœç´¢å¤„ç†å‡½æ•°
function handleSearch(query) {
    // åº”ç”¨åŸºç¡€è¿‡æ»¤
    const filteredQuery = basicFilter(query);
    
    // æ˜¾ç¤ºæœç´¢ç»“æœï¼ˆå­˜åœ¨XSSæ¼æ´ï¼‰
    document.getElementById('searchResult').innerHTML = 
        'æœç´¢ç»“æœï¼š' + filteredQuery;
}

// è¿‡æ»¤åˆ†æï¼š
// 1. åªè¿‡æ»¤äº†å°å†™çš„scriptæ ‡ç­¾
// 2. äº‹ä»¶å¤„ç†å™¨è¿‡æ»¤ä¸å®Œæ•´
// 3. æ²¡æœ‰è€ƒè™‘HTMLå®ä½“ç¼–ç 
// 4. æ²¡æœ‰è¿‡æ»¤å…¶ä»–å±é™©æ ‡ç­¾å¦‚imgã€svgç­‰
// 5. å¯ä»¥é€šè¿‡å¤§å°å†™æ··åˆã€ç¼–ç ç­‰æ–¹å¼ç»•è¿‡
            </div>
        </div>

        <div class="challenge-area fade-in">
            <h3>æœç´¢æµ‹è¯•åŒºåŸŸ</h3>
            
            <div class="form-group">
                <label for="searchInput">æœç´¢å†…å®¹ï¼š</label>
                <input type="text" id="searchInput" placeholder="è¾“å…¥æœç´¢å…³é”®è¯..." class="payload-input">
                <button onclick="performSearch()" class="btn">æœç´¢</button>
            </div>
            
            <div class="output-area">
                <h4>æœç´¢ç»“æœï¼š</h4>
                <div class="output-box" id="searchResult">
                    è¯·è¾“å…¥æœç´¢å…³é”®è¯
                </div>
            </div>
            
            <div class="form-group">
                <label>æµ‹è¯•è¿‡æ»¤æ•ˆæœï¼š</label>
                <textarea id="filterTest" rows="3" placeholder="è¾“å…¥å†…å®¹æŸ¥çœ‹è¿‡æ»¤æ•ˆæœ..." onkeyup="testFilter()"></textarea>
                <div class="output-box" id="filterResult" style="margin-top: 10px;">
                    è¿‡æ»¤ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ
                </div>
            </div>
            
            <div class="alert alert-warning">
                <strong>ç»•è¿‡æŠ€å·§ï¼š</strong>
                <ul>
                    <li>å¤§å°å†™æ··åˆï¼š&lt;ScRiPt&gt;ã€&lt;IMG&gt;</li>
                    <li>äº‹ä»¶å¤„ç†å™¨ï¼šonclickã€onloadã€onerrorã€onmouseover</li>
                    <li>å…¶ä»–æ ‡ç­¾ï¼š&lt;svg&gt;ã€&lt;img&gt;ã€&lt;iframe&gt;</li>
                    <li>HTMLå®ä½“ç¼–ç ï¼š&amp;lt; &amp;gt;</li>
                    <li>å±æ€§æ³¨å…¥ï¼šsrcã€hrefç­‰å±æ€§</li>
                </ul>
            </div>
        </div>

        <footer class="footer">
            <p>Â© 2024 XSSæŒ‘æˆ˜é¶åœº | ä»…ä¾›å­¦ä¹ ä½¿ç”¨</p>
        </footer>
    </div>

    <script>
        // é‡å†™alertå‡½æ•°ä»¥æ£€æµ‹XSSæˆåŠŸ
        const originalAlert = window.alert;
        window.alert = function(message) {
            originalAlert(message);
            if (message && message.toString().toLowerCase().includes('xss')) {
                setTimeout(() => {
                    alert('ğŸ‰ æ­å–œï¼è¿‡æ»¤ç»•è¿‡XSSæ”»å‡»æˆåŠŸï¼ä½ å·²ç»æŒæ¡äº†è¿‡æ»¤ç»•è¿‡æŠ€æœ¯ï¼');
                }, 100);
            }
        };

        // åŸºç¡€è¿‡æ»¤å‡½æ•°ï¼ˆå­˜åœ¨ç»•è¿‡æ¼æ´ï¼‰
        function basicFilter(input) {
            let filtered = input;
            
            // åªè¿‡æ»¤å°å†™çš„scriptæ ‡ç­¾ï¼ˆå¯ä»¥è¢«ç»•è¿‡ï¼‰
            filtered = filtered.replace(/<script>/gi, '');
            filtered = filtered.replace(/<\/script>/gi, '');
            
            // ä¸å®Œæ•´çš„äº‹ä»¶å¤„ç†å™¨è¿‡æ»¤ï¼ˆå¯ä»¥è¢«ç»•è¿‡ï¼‰
            filtered = filtered.replace(/javascript:/gi, '');
            filtered = filtered.replace(/on\w+=/gi, '');
            
            return filtered;
        }

        // æœç´¢å¤„ç†å‡½æ•°
        function handleSearch(query) {
            const filteredQuery = basicFilter(query);
            
            // å­˜åœ¨XSSæ¼æ´çš„è¾“å‡º
            document.getElementById('searchResult').innerHTML = 'æœç´¢ç»“æœï¼š' + filteredQuery;
        }

        function performSearch() {
            const query = document.getElementById('searchInput').value;
            if (!query.trim()) {
                alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }
            
            handleSearch(query);
        }

        function testFilter() {
            const input = document.getElementById('filterTest').value;
            const filtered = basicFilter(input);
            document.getElementById('filterResult').innerHTML = 
                '<strong>åŸå§‹è¾“å…¥ï¼š</strong>' + escapeHtml(input) + 
                '<br><strong>è¿‡æ»¤åï¼š</strong>' + escapeHtml(filtered);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // é¡µé¢åŠŸèƒ½å‡½æ•°
        function toggleHints() {
            const hints = document.getElementById('hints');
            hints.style.display = hints.style.display === 'none' ? 'block' : 'none';
        }

        function showSource() {
            alert('æºç å·²åœ¨"è¿‡æ»¤æœºåˆ¶åˆ†æ"éƒ¨åˆ†æ˜¾ç¤ºï¼Œè¯·æŸ¥çœ‹ä¸Šæ–¹çš„ä»£ç å—ã€‚');
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
        window.onload = function() {
            // é¡µé¢åŠ è½½åŠ¨ç”»
            const elements = document.querySelectorAll('.fade-in');
            elements.forEach((element, index) => {
                setTimeout(() => {
                    element.style.opacity = '0';
                    element.style.transform = 'translateY(20px)';
                    element.style.transition = 'all 0.6s ease';
                    setTimeout(() => {
                        element.style.opacity = '1';
                        element.style.transform = 'translateY(0)';
                    }, 100);
                }, index * 200);
            });
        };

        // å›è½¦æœç´¢
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && event.target.id === 'searchInput') {
                performSearch();
            }
        });
    </script>

    <style>
        .payload-input {
            font-family: 'Courier New', monospace;
            background-color: #f8f9fa;
        }

        .output-area {
            margin: 20px 0;
        }

        .output-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            min-height: 50px;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
        }

        #filterResult {
            background: #fff3cd;
            border-color: #ffeaa7;
            font-size: 14px;
        }

        textarea {
            resize: vertical;
            font-family: 'Courier New', monospace;
        }
    </style>
</body>
</html>