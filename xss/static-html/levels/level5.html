<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­‰çº§5 - å±æ€§æ³¨å…¥XSS</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div class="container">
        <header class="fade-in">
            <h1>ç­‰çº§5 - å±æ€§æ³¨å…¥XSS</h1>
            <p class="subtitle">é€šè¿‡HTMLå±æ€§æ³¨å…¥å®ç°XSSæ”»å‡»</p>
        </header>

        <div class="navigation fade-in">
            <a href="../index.html" class="btn btn-secondary">â† è¿”å›ä¸»é¡µ</a>
            <span class="level-info">éš¾åº¦: ä¸­ç­‰ | 5/8</span>
        </div>

        <div class="challenge-area fade-in">
            <h2>æŒ‘æˆ˜æè¿°</h2>
            <p>å±æ€§æ³¨å…¥XSSå‘ç”Ÿåœ¨ç”¨æˆ·è¾“å…¥è¢«æ’å…¥åˆ°HTMLæ ‡ç­¾çš„å±æ€§ä¸­æ—¶ã€‚å³ä½¿æ ‡ç­¾æœ¬èº«æ˜¯å®‰å…¨çš„ï¼Œæ¶æ„çš„å±æ€§å€¼ä¹Ÿå¯èƒ½å¯¼è‡´JavaScriptæ‰§è¡Œã€‚è¿™ç§æ”»å‡»å¸¸è§äºå›¾ç‰‡é“¾æ¥ã€è¡¨å•å€¼ç­‰åœºæ™¯ã€‚</p>
            
            <div class="alert alert-info">
                <strong>ç›®æ ‡ï¼š</strong>é€šè¿‡ä¿®æ”¹å›¾ç‰‡é“¾æ¥çš„å€¼ï¼Œæ³¨å…¥æ¶æ„å±æ€§æ¥æ‰§è¡ŒJavaScriptä»£ç å¹¶å¼¹å‡ºåŒ…å«"XSS"çš„è­¦å‘Šæ¡†ã€‚
            </div>

            <div class="button-group">
                <button class="btn-secondary" onclick="toggleHints()">æ˜¾ç¤ºæç¤º</button>
                <button class="btn-secondary" onclick="showSource()">æŸ¥çœ‹æºç </button>
            </div>
        </div>

        <div class="hint-box fade-in" id="hints" style="display: none;">
            <div class="hint-title">ğŸ’¡ æç¤º</div>
            <ul>
                <li>ç”¨æˆ·è¾“å…¥è¢«ç›´æ¥æ’å…¥åˆ°imgæ ‡ç­¾çš„srcå±æ€§ä¸­</li>
                <li>å¯ä»¥é€šè¿‡é—­åˆå¼•å·æ¥æ³¨å…¥æ–°çš„å±æ€§</li>
                <li>å°è¯•æ·»åŠ äº‹ä»¶å¤„ç†å™¨å±æ€§ï¼Œå¦‚onerrorã€onloadç­‰</li>
                <li>ç¤ºä¾‹ï¼šx" onerror="alert('XSS')</li>
                <li>æˆ–è€…ï¼šjavascript:alert('XSS')</li>
                <li>è¿˜å¯ä»¥å°è¯•ï¼šx' onload='alert(\"XSS\")'</li>
                <li>æ³¨æ„å¼•å·çš„é—­åˆå’Œè½¬ä¹‰</li>
            </ul>
        </div>

        <div class="challenge-area fade-in">
            <h3>æ¼æ´ä»£ç åˆ†æ</h3>
            <div class="code-block">
// å›¾ç‰‡æ˜¾ç¤ºå‡½æ•°
function displayImage(imageUrl) {
    // ç›´æ¥å°†ç”¨æˆ·è¾“å…¥æ’å…¥åˆ°HTMLå±æ€§ä¸­ï¼ˆå­˜åœ¨XSSæ¼æ´ï¼‰
    const imgHtml = '&lt;img src="' + imageUrl + '" alt="ç”¨æˆ·å›¾ç‰‡" width="200"&gt;';
    
    // ä½¿ç”¨innerHTMLè¾“å‡º
    document.getElementById('imageContainer').innerHTML = imgHtml;
}

// è¡¨å•å¤„ç†å‡½æ•°
function updateProfile(name, value) {
    // ç›´æ¥å°†ç”¨æˆ·è¾“å…¥ä½œä¸ºè¡¨å•å€¼ï¼ˆå­˜åœ¨XSSæ¼æ´ï¼‰
    const inputHtml = '&lt;input type="text" value="' + value + '" readonly&gt;';
    
    document.getElementById('profileContainer').innerHTML = 
        '&lt;label&gt;' + name + ':&lt;/label&gt;' + inputHtml;
}

// æ¼æ´åˆ†æï¼š
// 1. ç”¨æˆ·è¾“å…¥ç›´æ¥æ’å…¥åˆ°HTMLå±æ€§ä¸­
// 2. æ²¡æœ‰å¯¹å¼•å·è¿›è¡Œè½¬ä¹‰æˆ–è¿‡æ»¤
// 3. æ”»å‡»è€…å¯ä»¥é—­åˆå±æ€§å¹¶æ³¨å…¥æ–°å±æ€§
// 4. äº‹ä»¶å¤„ç†å™¨å±æ€§å¯ä»¥æ‰§è¡ŒJavaScriptä»£ç 

// æ”»å‡»ç¤ºä¾‹ï¼š
// è¾“å…¥ï¼šx" onerror="alert('XSS')"
// ç”Ÿæˆï¼š&lt;img src="x" onerror="alert('XSS')"" alt="ç”¨æˆ·å›¾ç‰‡"&gt;
// ç»“æœï¼šå½“å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶æ‰§è¡Œalert('XSS')
            </div>
        </div>

        <div class="challenge-area fade-in">
            <h3>å›¾ç‰‡é“¾æ¥æµ‹è¯•åŒºåŸŸ</h3>
            
            <div class="form-group">
                <label for="imageUrl">å›¾ç‰‡é“¾æ¥ï¼š</label>
                <input type="text" id="imageUrl" placeholder="è¾“å…¥å›¾ç‰‡URL..." class="payload-input" value="https://via.placeholder.com/200x150">
                <button onclick="loadImage()" class="btn">åŠ è½½å›¾ç‰‡</button>
            </div>
            
            <div class="output-area">
                <h4>å›¾ç‰‡æ˜¾ç¤ºåŒºåŸŸï¼š</h4>
                <div class="output-box" id="imageContainer">
                    <img src="https://via.placeholder.com/200x150" alt="é»˜è®¤å›¾ç‰‡" width="200">
                </div>
            </div>
            
            <div class="form-group">
                <label>ç”Ÿæˆçš„HTMLä»£ç ï¼š</label>
                <textarea id="generatedHtml" rows="3" readonly class="code-display"></textarea>
            </div>
        </div>

        <div class="challenge-area fade-in">
            <h3>ç”¨æˆ·èµ„æ–™æµ‹è¯•åŒºåŸŸ</h3>
            
            <div class="form-group">
                <label for="profileName">å­—æ®µåç§°ï¼š</label>
                <input type="text" id="profileName" value="ç”¨æˆ·å" placeholder="è¾“å…¥å­—æ®µåç§°...">
            </div>
            
            <div class="form-group">
                <label for="profileValue">å­—æ®µå€¼ï¼š</label>
                <input type="text" id="profileValue" placeholder="è¾“å…¥å­—æ®µå€¼..." class="payload-input" value="å¼ ä¸‰">
                <button onclick="updateUserProfile()" class="btn">æ›´æ–°èµ„æ–™</button>
            </div>
            
            <div class="output-area">
                <h4>ç”¨æˆ·èµ„æ–™æ˜¾ç¤ºï¼š</h4>
                <div class="output-box" id="profileContainer">
                    <label>ç”¨æˆ·å:</label><input type="text" value="å¼ ä¸‰" readonly>
                </div>
            </div>
            
            <div class="alert alert-warning">
                <strong>å±æ€§æ³¨å…¥æŠ€å·§ï¼š</strong>
                <ul>
                    <li>é—­åˆå¼•å·ï¼šä½¿ç”¨"æˆ–'æ¥é—­åˆå½“å‰å±æ€§</li>
                    <li>æ³¨å…¥äº‹ä»¶ï¼šonerrorã€onloadã€onclickã€onmouseoverç­‰</li>
                    <li>JavaScriptåè®®ï¼šjavascript:alert('XSS')</li>
                    <li>å¤šé‡ç¼–ç ï¼šHTMLå®ä½“ã€URLç¼–ç ç­‰</li>
                    <li>æ³¨æ„ä¸Šä¸‹æ–‡ï¼šå•å¼•å·ã€åŒå¼•å·çš„ä½¿ç”¨</li>
                </ul>
            </div>
        </div>

        <footer class="footer">
            <p>Â© 2024 XSSæŒ‘æˆ˜é¶åœº | ä»…ä¾›å­¦ä¹ ä½¿ç”¨</p>
        </footer>
    </div>

    <script>
        // é‡å†™alertå‡½æ•°ä»¥æ£€æµ‹XSSæˆåŠŸ
        const originalAlert = window.alert;
        window.alert = function(message) {
            originalAlert(message);
            if (message && message.toString().toLowerCase().includes('xss')) {
                setTimeout(() => {
                    alert('ğŸ‰ æ­å–œï¼å±æ€§æ³¨å…¥XSSæ”»å‡»æˆåŠŸï¼ä½ å·²ç»æŒæ¡äº†å±æ€§æ³¨å…¥æŠ€æœ¯ï¼');
                }, 100);
            }
        };

        // å±æ€§æ³¨å…¥XSSæ¼æ´å‡½æ•°
        function displayImage(imageUrl) {
            // å­˜åœ¨XSSæ¼æ´ï¼šç›´æ¥æ’å…¥åˆ°å±æ€§ä¸­
            const imgHtml = '<img src="' + imageUrl + '" alt="ç”¨æˆ·å›¾ç‰‡" width="200" style="max-width: 100%; height: auto;">';
            
            document.getElementById('imageContainer').innerHTML = imgHtml;
            
            // æ˜¾ç¤ºç”Ÿæˆçš„HTMLä»£ç 
            document.getElementById('generatedHtml').value = imgHtml;
        }

        function updateProfile(name, value) {
            // å­˜åœ¨XSSæ¼æ´ï¼šç›´æ¥æ’å…¥åˆ°å±æ€§ä¸­
            const inputHtml = '<input type="text" value="' + value + '" readonly style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">';
            
            document.getElementById('profileContainer').innerHTML = 
                '<label style="display: block; margin-bottom: 5px; font-weight: bold;">' + name + ':</label>' + inputHtml;
        }

        function loadImage() {
            const imageUrl = document.getElementById('imageUrl').value;
            if (!imageUrl.trim()) {
                alert('è¯·è¾“å…¥å›¾ç‰‡URL');
                return;
            }
            
            displayImage(imageUrl);
        }

        function updateUserProfile() {
            const name = document.getElementById('profileName').value;
            const value = document.getElementById('profileValue').value;
            
            if (!name.trim() || !value.trim()) {
                alert('è¯·å¡«å†™å­—æ®µåç§°å’Œå€¼');
                return;
            }
            
            updateProfile(name, value);
        }

        // é¡µé¢åŠŸèƒ½å‡½æ•°
        function toggleHints() {
            const hints = document.getElementById('hints');
            hints.style.display = hints.style.display === 'none' ? 'block' : 'none';
        }

        function showSource() {
            alert('æºç å·²åœ¨"æ¼æ´ä»£ç åˆ†æ"éƒ¨åˆ†æ˜¾ç¤ºï¼Œè¯·æŸ¥çœ‹ä¸Šæ–¹çš„ä»£ç å—ã€‚');
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
        window.onload = function() {
            // åˆå§‹åŒ–æ˜¾ç¤º
            displayImage('https://via.placeholder.com/200x150');
            updateProfile('ç”¨æˆ·å', 'å¼ ä¸‰');
            
            // é¡µé¢åŠ è½½åŠ¨ç”»
            const elements = document.querySelectorAll('.fade-in');
            elements.forEach((element, index) => {
                setTimeout(() => {
                    element.style.opacity = '0';
                    element.style.transform = 'translateY(20px)';
                    element.style.transition = 'all 0.6s ease';
                    setTimeout(() => {
                        element.style.opacity = '1';
                        element.style.transform = 'translateY(0)';
                    }, 100);
                }, index * 200);
            });
        };

        // å›è½¦æäº¤
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                if (event.target.id === 'imageUrl') {
                    loadImage();
                } else if (event.target.id === 'profileValue') {
                    updateUserProfile();
                }
            }
        });
    </script>

    <style>
        .payload-input {
            font-family: 'Courier New', monospace;
            background-color: #f8f9fa;
        }

        .code-display {
            font-family: 'Courier New', monospace;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            resize: vertical;
        }

        .output-area {
            margin: 20px 0;
        }

        .output-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            min-height: 80px;
            word-wrap: break-word;
        }

        .output-box img {
            display: block;
            margin: 10px auto;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .output-box label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .output-box input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
    </style>
</body>
</html>